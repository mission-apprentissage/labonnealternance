import { asyncForEach } from "@/common/utils/asyncUtils"
import { getDbCollection } from "@/common/utils/mongodbUtils"

export const up = async () => {
  const map = {
    "Exploitation agricole": ["A1301", "A1405", "A1407", "A1410", "A1411", "A1416", "A1413", "A1409", "A1304", "A1420", "A1401"],
    "Animation jeunesse, culturelle, touristique": ["G1202", "G1201", "G1203", "K1802", "K1206", "K1307", "G1223"],
    "Bijouterie, Joaillerie, Horlogerie, Gemmologie": ["B1603", "B1604", "H3401", "B1605"],
    "Conduite d'engins de chantier": ["F1302", "N1101", "F1301", "F1704", "N4107"],
    "Developpement commercial, force de vente": ["D1403", "D1402", "D1404", "D1406", "D1409", "D1410", "D1420", "D1415", "D1416", "D1510", "M1823", "M1715", "E1113"],
    "Management commercial": ["D1406", "D1407", "D1509", "D1502", "D1503", "D1402", "D1301", "D1504", "D1403", "D1508", "D1409", "D1410", "M1715"],
    "Vente en magasin : produits non alimentaires (vetements, equipement, livres, …)": [
      "D1211",
      "D1212",
      "D1214",
      "D1210",
      "D1503",
      "D1408",
      "D1501",
      "D1403",
      "D1507",
      "D1402",
      "D1106",
      "D1201",
      "D1204",
      "D1213",
      "N1110",
      "D1221",
    ],
    "Teleconseil, vente a distance": ["D1408", "E1113"],
    "Communication, marketing, publicite": [
      "E1103",
      "E1104",
      "E1401",
      "E1105",
      "E1402",
      "E1205",
      "M1703",
      "M1707",
      "M1705",
      "M1704",
      "M1706",
      "M1702",
      "E1112",
      "M1716",
      "E1109",
      "M1711",
    ],
    "Comptabilite, gestion de paie": ["M1206", "M1203", "M1202", "M1507", "M1611"],
    "Installation et maintenance reseaux telecom et energie": ["I1307", "F1113", "M1816", "F1623", "I1312", "I1314"],
    "Assainissement biologique, nucleaire, depollution": ["I1503", "H1303", "K2305", "F1116", "H1225", "H2508", "I1505", "H1309", "K2307"],
    "Finance, Analyse financiere, controle de gestion, tresorerie": ["M1205", "M1201", "M1204", "M1207", "M1206", "C1301", "K1504", "M1208", "M1611"],
    Formation: ["K2101", "K2102", "K2111", "K2110", "K2114", "M1504"],
    "Management, direction d'hotel, restaurant, loisirs": ["G1402", "G1403", "G1802", "G1401", "G1404", "K1802", "G1810", "G1409", "G1411"],
    Cuisine: ["G1603", "G1402", "G1602", "G1604", "G1601", "G1401", "G1606", "G1609", "G1810", "G1608", "G1607"],
    "Vente, transaction, gestion immobiliere": ["C1504", "C1501", "C1502", "C1503", "C1505"],
    "Risques, qualite, hygiene, securite, environnement (QHSE)": [
      "H1404",
      "H1506",
      "H1504",
      "H1302",
      "H1502",
      "H1303",
      "H1402",
      "H1403",
      "H1206",
      "H1501",
      "H1401",
      "F1204",
      "H1301",
      "H1308",
      "H1304",
      "H1518",
      "H1309",
    ],
    Energie: ["H1302", "H1206", "H2502", "H1102", "I1102", "H1502", "H1504", "H1209", "H1402", "F1203", "I1302", "I1304", "F1401", "F1402", "H2701", "H1225", "H2508", "H1309"],
    "Gestion de projets informatiques": ["M1803", "M1806", "M1828", "M1858", "M1814", "M1410"],
    "Analyse de donnees, data": ["M1805", "M1403", "M1806", "M1802", "M1809", "M1405", "M1846", "M1811"],
    "Developpement web, integration": [
      "M1805",
      "M1806",
      "M1802",
      "M1827",
      "M1812",
      "M1855",
      "M1841",
      "M1846",
      "M1860",
      "M1813",
      "M1818",
      "M1842",
      "M1856",
      "M1844",
      "M1821",
      "M1861",
    ],
    "Administration de systemes et reseaux informatiques et telecom": [
      "M1801",
      "M1802",
      "M1806",
      "M1810",
      "M1804",
      "H1101",
      "M1827",
      "M1812",
      "M1816",
      "M1841",
      "M1846",
      "M1860",
      "M1818",
      "M1822",
      "M1830",
      "M1835",
      "M1856",
      "M1844",
      "M1854",
    ],
    "Mecanique, carrosserie auto, moto": ["I1604", "I1606", "I1607", "H3404", "H1203", "I1613", "I1609", "I1617"],
    "Administration publique (impots, hopitaux, prisons, structures sociales, …)": [
      "K1401",
      "K1402",
      "K1403",
      "K1405",
      "K1501",
      "K1503",
      "M1301",
      "K1404",
      "K1502",
      "K1504",
      "H1105",
      "K1408",
      "K1409",
    ],
    "Sante, soins aux personnes": [
      "J1301",
      "J1502",
      "J1506",
      "J1501",
      "K2601",
      "K2603",
      "J1102",
      "J1104",
      "J1503",
      "J1504",
      "J1505",
      "J1507",
      "K1306",
      "J1101",
      "H1105",
      "J1103",
      "J1508",
      "K1409",
    ],
    "Education specialisee, assistance aupres d'enfants, puericulture": ["K1303", "J1304", "K1202", "K1308", "K1310", "K1307", "K2113", "K1208"],
    "Education specialisee, assistance aupres d'adultes": ["K1301", "K1302", "K1305", "K1205", "K1204", "K1206", "K1207", "K1201", "K1101", "K1102", "K1306", "K1311", "K1208"],
    "Metiers du sport": ["G1204", "L1401", "H1206", "G1209", "G1217", "G1213"],
    "Magasinage, manutention, entreposage, preparation de commandes": ["N1103", "N1301", "N1303", "N1104", "N1105", "H3302", "N4120", "N1113", "N1110", "N1115"],
    "Transport, conduite, livraison": ["N4101", "N1102", "N4402", "N4103", "M1603", "N4104", "N4120", "N4109", "N4107", "N4109", "N4105"],
  }

  await asyncForEach(Object.entries(map), ([sousDomaine, codesRomes]) =>
    getDbCollection("domainesmetiers").updateOne({ sous_domaine_sans_accent_computed: sousDomaine }, { $set: { codes_romes: codesRomes } })
  )
}
// set to false ONLY IF migration does not imply a breaking change (ex: update field value or add index)
export const requireShutdown: boolean = false
